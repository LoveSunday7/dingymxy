<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0">
    <link rel="icon" href="./images/girlhead.jpg" type="image/x-icon">
    <title>黑色小猫咪的GitHub小窝</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- 基础样式 -->
    <link rel="stylesheet" href="./css/base.css">
    <link rel="stylesheet" href="./css/nav.css">
    <link rel="stylesheet" href="./css/background-panel.css">
    
    <!-- 页面样式 -->
    <link rel="stylesheet" href="./css/pages/home.css">
    <link rel="stylesheet" href="./css/pages/resume.css">
    <link rel="stylesheet" href="./css/pages/experience.css">
    <link rel="stylesheet" href="./css/pages/blog.css"> <!-- 新增博客样式 -->
    <link rel="stylesheet" href="./css/pages/friends.css">
    <link rel="stylesheet" href="./css/pages/contact.css">
</head>

<body class="dark-mode"> <!-- 直接在body上添加dark-mode类 -->
    <!-- 背景层 -->
    <div class="background-layer"></div>
    <div class="content-overlay"></div>

    <!-- 导航栏 (通过JavaScript加载) -->
    <header id="mainHeader"></header>

    <!-- 背景设置面板 (通过JavaScript加载) -->
    <div id="backgroundPanel"></div>

    <!-- 页面内容 -->
    <main id="mainContent">
        <!-- 首页 -->
        <section id="home" class="page active"></section>

        <!-- 简历页面 -->
        <section id="resume" class="page"></section>

        <!-- 经历页面 -->
        <section id="experience" class="page"></section>

        <!-- 博客页面 --> <!-- 新增博客页面 -->
        <section id="blog" class="page"></section>

        <!-- 朋友圈页面 -->
        <section id="friends" class="page"></section>

        <!-- 联系我页面 -->
        <section id="contact" class="page"></section>
    </main>

    <!-- 页脚 (通过JavaScript加载) -->
    <footer></footer>

    <!-- 核心JavaScript文件 -->
    <script src="./js/utils.js"></script>
    <script src="./js/theme.js"></script>
    <script src="./js/background.js"></script>
    <script src="./js/mobile-nav.js"></script>
    <script src="./js/router.js"></script>

    <!-- 页面特定的JavaScript -->
    <script src="./js/pages/home.js"></script>
    <script src="./js/pages/resume.js"></script>
    <script src="./js/pages/experience.js"></script>
    <script src="./js/pages/blog.js"></script> <!-- 新增博客JS -->
    <script src="./js/pages/friends.js"></script>
    <script src="./js/pages/contact.js"></script>

    <!-- 初始化加载 -->
    <script>
        // 加载HTML模块
        window.addEventListener('DOMContentLoaded', async () => {
            try {
                console.log('开始加载模块...');

                // 加载导航栏
                const navHtml = await (await fetch('./modules/nav.html')).text();
                document.getElementById('mainHeader').innerHTML = navHtml;

                const bgPanelHtml = await (await fetch('./modules/background-panel.html')).text();
                document.getElementById('backgroundPanel').innerHTML = bgPanelHtml;

                // 加载页面内容
                const pageIds = ['home', 'resume', 'experience', 'blog', 'friends', 'contact']; // 添加blog
                for (const pageId of pageIds) {
                    const response = await fetch(`./modules/pages/${pageId}.html`);
                    const html = await response.text();
                    document.getElementById(pageId).innerHTML = html;
                }

                // 加载页脚
                const footerResponse = await fetch('./modules/footer.html');
                const footerHtml = await footerResponse.text();
                document.querySelector('footer').innerHTML = footerHtml;

                console.log('所有模块加载完成');

                // 给一点时间让DOM完全渲染
                setTimeout(() => {
                    // 初始化所有模块
                    if (typeof initUtils === 'function') initUtils();
                    if (typeof initTheme === 'function') initTheme();
                    if (typeof initBackground === 'function') initBackground();
                    if (typeof initMobileNav === 'function') initMobileNav();
                    if (typeof initRouter === 'function') initRouter();

                    // 初始化页面特定的功能
                    if (typeof initHome === 'function') initHome();
                    if (typeof initResume === 'function') initResume();
                    if (typeof initExperience === 'function') initExperience();
                    if (typeof initBlog === 'function') initBlog(); // 添加博客初始化
                    if (typeof initFriends === 'function') initFriends();
                    if (typeof initContact === 'function') initContact();

                    // 初始化滚动效果
                    if (typeof initScrollAnimation === 'function') initScrollAnimation();
                    if (typeof initScrollHeader === 'function') initScrollHeader();

                    console.log('所有功能初始化完成');

                    // 页面加载动画
                    document.body.style.opacity = '0';
                    document.body.style.transition = 'opacity 0.5s';

                    setTimeout(() => {
                        document.body.style.opacity = '1';
                    }, 100);

                }, 200);

            } catch (error) {
                console.error('加载模块时出错:', error);
                document.body.innerHTML = '<div style="padding: 2rem; text-align: center; color: red;">页面加载失败，请检查网络连接。</div>';
            }
        });
    </script>
</body>

</html>